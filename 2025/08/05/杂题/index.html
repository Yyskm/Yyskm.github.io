<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>杂题 | yskm</title><meta name="author" content="yskm"><meta name="copyright" content="yskm"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Nepnep2025 Lattice Bros 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#已知α的极小多项式为三次多项式f(x),即f(α)&#x3D;0,且α≈54236.6061888817548096712801515417818951833377">
<meta property="og:type" content="article">
<meta property="og:title" content="杂题">
<meta property="og:url" content="http://example.com/2025/08/05/%E6%9D%82%E9%A2%98/index.html">
<meta property="og:site_name" content="yskm">
<meta property="og:description" content="Nepnep2025 Lattice Bros 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#已知α的极小多项式为三次多项式f(x),即f(α)&#x3D;0,且α≈54236.6061888817548096712801515417818951833377">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/1.jpg">
<meta property="article:published_time" content="2025-08-05T15:47:20.058Z">
<meta property="article:modified_time" content="2025-09-13T04:49:13.967Z">
<meta property="article:author" content="yskm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/1.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "杂题",
  "url": "http://example.com/2025/08/05/%E6%9D%82%E9%A2%98/",
  "image": "http://example.com/img/1.jpg",
  "datePublished": "2025-08-05T15:47:20.058Z",
  "dateModified": "2025-09-13T04:49:13.967Z",
  "author": [
    {
      "@type": "Person",
      "name": "yskm",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/08/05/%E6%9D%82%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '杂题',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/transpancy.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/preview.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">yskm</span></a><a class="nav-page-title" href="/"><span class="site-name">杂题</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">杂题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-05T15:47:20.058Z" title="发表于 2025-08-05 23:47:20">2025-08-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-13T04:49:13.967Z" title="更新于 2025-09-13 12:49:13">2025-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Wp/">Wp</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="nepnep2025-lattice-bros">Nepnep2025 Lattice Bros</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#已知α的极小多项式为三次多项式f(x),即f(α)=0,且α≈54236.606188881754809671280151541781895183337725393</span><br><span class="line"></span><br><span class="line">#上述极小多项式的常数项为a0</span><br><span class="line"></span><br><span class="line">from secret import a0,alpha</span><br><span class="line"></span><br><span class="line">import gmpy2</span><br><span class="line"></span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line"></span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">from math import sqrt,log2</span><br><span class="line"></span><br><span class="line">d=981020902672546902438782010902608140583199504862558032616415</span><br><span class="line"></span><br><span class="line">p = d - a0</span><br><span class="line"></span><br><span class="line">k=sqrt(log2(p))+log2(log2(p))</span><br><span class="line"></span><br><span class="line">B = 2**30</span><br><span class="line"></span><br><span class="line">assert B &lt; p/2**k</span><br><span class="line"></span><br><span class="line">m = 30</span><br><span class="line"></span><br><span class="line">assert m &gt; 2*sqrt(log2(p))</span><br><span class="line"></span><br><span class="line">samples = []</span><br><span class="line"></span><br><span class="line">betas = []</span><br><span class="line"></span><br><span class="line">f = open(&quot;samples.txt&quot;,&#x27;w&#x27;)</span><br><span class="line"></span><br><span class="line">for _ in range(m):</span><br><span class="line"></span><br><span class="line">  t = random.randint(1, p-1)</span><br><span class="line"></span><br><span class="line">  beta = random.randint(-B + 1, B - 1)</span><br><span class="line"></span><br><span class="line">  a = (t * alpha - beta) % p</span><br><span class="line"></span><br><span class="line">  samples.append((t, a))</span><br><span class="line"></span><br><span class="line">  betas.append(beta)</span><br><span class="line"></span><br><span class="line">f.write(str(samples))</span><br><span class="line"></span><br><span class="line">for i in range(0,30):</span><br><span class="line"></span><br><span class="line">  assert (betas[i]-samples[i][0]*alpha+samples[i][1])%p == 0</span><br><span class="line"></span><br><span class="line">#flag = long_to_bytes(alpha)</span><br></pre></td></tr></table></figure>
<p>首先我们需要恢复的是a0的值</p>
<p>我们可以利用LLL算法来恢复一定次数的极小多项式，对于多项式来说我们有
<span
class="math display"><em>a</em><sub>0</sub> + <em>a</em><sub>1</sub><em>x</em> + <em>a</em><sub>2</sub><em>x</em><sup>2</sup> + <em>a</em><sub>3</sub><em>x</em><sup>3</sup> = 0</span></p>
<p><span class="math display">$$
\begin{pmatrix}
a_0&amp;a_1&amp;a_2&amp;a_3
\end{pmatrix}\begin{pmatrix}
1 &amp;0&amp; 0 &amp; a^0M\\
0&amp; 1 &amp; 0 &amp; a^1M\\
0&amp;0&amp; 1 &amp; a^2M\\
0&amp;0&amp;  0&amp;a^3M
\end{pmatrix}
$$</span></p>
<p>这里我们M我们根据a的的精度选择10^50来配平</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">54236.606188881754809671280151541781895183337725393</span></span><br><span class="line"></span><br><span class="line">M=<span class="number">10</span>**<span class="number">50</span></span><br><span class="line"></span><br><span class="line">Matrix=matrix(ZZ,[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,a^<span class="number">0</span>*M],</span><br><span class="line"></span><br><span class="line">         [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,a^<span class="number">1</span>*M],</span><br><span class="line"></span><br><span class="line">         [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,a^<span class="number">2</span>*M],</span><br><span class="line"></span><br><span class="line">         [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,a^<span class="number">3</span>*M]])</span><br><span class="line"></span><br><span class="line">L=Matrix.LLL()</span><br><span class="line"></span><br><span class="line">a0=L[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a0)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里其它师傅那里看到了sagemath的内置函数可以求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">alpha = <span class="number">54236.606188881754809671280151541781895183337725393</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">f = algdep(alpha, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a0 = f(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a0)</span><br></pre></td></tr></table></figure>
<p>得到a0之后我们可以直接求出p</p>
<p>之后就是HNP问题了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a0=-<span class="number">159534088683654</span></span><br><span class="line"></span><br><span class="line">lis = [(<span class="number">541847931463604073209188621415697353813245102261880389530448</span>, <span class="number">293760933113243563398917466885108625646262447370201484418246</span>), (<span class="number">235213326900086489464935804156966465366154623411555613791270</span>, <span class="number">660823982268225103178763707015491421784294988488272636270997</span>), (<span class="number">826464884761457937459245903152143755707241416981488127320435</span>, <span class="number">428521663319038461250005113612781686761766888058391496085911</span>), (<span class="number">589542000504317435156560078533519448295689695687499354390208</span>, <span class="number">155284353896000150766154807679279597476176668344402166959399</span>), (<span class="number">968823371588600973965757332601758200815345862153455338808286</span>, <span class="number">870008943690791009196027169525956126827736285614393106689402</span>), (<span class="number">621636099728440147413990266662022925118216803638588918660041</span>, <span class="number">265635912066749696542909843111997941904342442664219734956888</span>), (<span class="number">426696569424050102229606043215592727790577655338668728275370</span>, <span class="number">279313121876980354011480010042682666651614765507190502627689</span>), (<span class="number">89450479064580125731654556963306718472532905610952012502649</span>, <span class="number">465933125964565419295325650759566635253450915499965633327941</span>), (<span class="number">480355476500393865742379469913983270769356894135485925662119</span>, <span class="number">894041172171871806404285309781862268351135623868845025443422</span>), (<span class="number">842436524669577199024236805258573090764419350786291073287889</span>, <span class="number">345478552143958037534551648319293899442551000874041707820740</span>), (<span class="number">650054674429185550652935714084022116516082323269321462104664</span>, <span class="number">441999979283903658157822753439653947343822546158589507765994</span>), (<span class="number">46289431385578693366971976442426853079852982529357847290686</span>, <span class="number">625618376463384339878849844467050454204685252824782609369180</span>), (<span class="number">71444185449163133531919043374545893927347050624346741281881</span>, <span class="number">955925578289311966288639224625142299309823207245807788495453</span>), (<span class="number">192579726169321656812883068526498248523814846320328766176253</span>, <span class="number">626481822474054336470183912297952839011392733501646931370367</span>), (<span class="number">736527635648804640774976580747540045854351230084566721853611</span>, <span class="number">276626211757586963928788091386096607703513204646314683038338</span>), (<span class="number">177922521867185878959621840269164617147915792720210315529733</span>, <span class="number">541058782621716573816245900423919799500476442285991532228641</span>), (<span class="number">40610451174818168154306630612571678739921107216052349044576</span>, <span class="number">727642592899858828601137105077611015328512898368636299587376</span>), (<span class="number">385012983728389322601149562441674995471397288632464238356283</span>, <span class="number">353921151307105661267278594470212933060655245893209524497156</span>), (<span class="number">750447975601038834764379841158092390933760641866111445401426</span>, <span class="number">391626416964965737035878375834907580903143512300198923948189</span>), (<span class="number">115058604943298010958881205548782439407592353731185670266593</span>, <span class="number">491630592857258949793489206081490523001249620510479961058022</span>), (<span class="number">327389234395954477946639629629085910688793716425320663599360</span>, <span class="number">24975272330009592102362429346350824580378490147041708568130</span>), (<span class="number">115595274689129534885608766476695918464309130165432995990883</span>, <span class="number">757961876891952019297626599379744405302595090402128271144165</span>), (<span class="number">950804723308776351161744501221236453742418549093165078282534</span>, <span class="number">20307246759635231945223392614290397512873344480184942904518</span>), (<span class="number">724537610412063699714461780160573528810830178440136810747811</span>, <span class="number">149681928388378582933943374524511804362928290938917573644613</span>), (<span class="number">340891278018589324130004945217960336392205386747747011263373</span>, <span class="number">683307718413135477104477081812052183267507312278283317237187</span>), (<span class="number">104379682905784169840335131193505192063050242530811180817410</span>, <span class="number">715010230598797717533306270232399781090458356371977748416491</span>), (<span class="number">644160326926600986730919713173510327120201404569141824224075</span>, <span class="number">127877985489410167008195578625004740882394608402141169695352</span>), (<span class="number">549253388716005399852261816416312267100135940382820676807345</span>, <span class="number">210560134643237517255193955173709174155305784935427470113433</span>), (<span class="number">968265711632086435506163736279856957220961064226797549228006</span>, <span class="number">273174723915971720522674140326199419265943707917542063022561</span>), (<span class="number">704367622558261900937184683100177434487519780290678439135652</span>, <span class="number">959106497548134540301589019840013331842784496835379005298630</span>)]</span><br><span class="line"></span><br><span class="line">d=<span class="number">981020902672546902438782010902608140583199504862558032616415</span></span><br><span class="line"></span><br><span class="line">p = d - a0</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p.is_prime():</span><br><span class="line"></span><br><span class="line">  B = <span class="number">2</span>**<span class="number">30</span></span><br><span class="line"></span><br><span class="line">  ge = [[<span class="number">0</span>] * <span class="number">32</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line"></span><br><span class="line">    ge[i][i] = p</span><br><span class="line"></span><br><span class="line">    ge[-<span class="number">2</span>][i] = lis[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    ge[-<span class="number">1</span>][i] = lis[i][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  ge[-<span class="number">2</span>][-<span class="number">2</span>] = B/p</span><br><span class="line"></span><br><span class="line">  ge[-<span class="number">1</span>][-<span class="number">1</span>] = B</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  Ge = Matrix(QQ, ge)</span><br><span class="line"></span><br><span class="line">  L = Ge.LLL()</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> row <span class="keyword">in</span> L:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(row[-<span class="number">1</span>]) == B:</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">      <span class="built_in">print</span>(long_to_bytes(p-<span class="built_in">int</span>(row[-<span class="number">2</span>]*p/B)))</span><br></pre></td></tr></table></figure>
<h1 id="nepnep2025-ezrsa2">Nepnep2025 ezRSA2</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime, getRandomNBitInteger, GCD, inverse, long_to_bytes, bytes_to_long, sieve_base</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_parameters</span>(<span class="params">gamma=<span class="number">0.33</span>, beta=<span class="number">0.33</span></span>):</span><br><span class="line"></span><br><span class="line">  p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">  q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">  N = p*q</span><br><span class="line"></span><br><span class="line">  phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    d = getRandomNBitInteger(<span class="built_in">int</span>(<span class="number">2048</span>*beta))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  e = inverse(d, phi)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  hints = []</span><br><span class="line"></span><br><span class="line">  M = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(sieve_base)):</span><br><span class="line"></span><br><span class="line">    li = sieve_base[i]</span><br><span class="line"></span><br><span class="line">    hints.append(d%li)</span><br><span class="line"></span><br><span class="line">    M *= li</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> M.bit_length() &gt;= <span class="number">1024</span>*gamma:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> e, N, hints</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">  e,N,hints = gen_parameters()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;e=<span class="subst">&#123;<span class="built_in">hex</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;N=<span class="subst">&#123;<span class="built_in">hex</span>(N)&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;hints=<span class="subst">&#123;hints&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  flag_prefix = <span class="string">b&#x27;NepCTF&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">assert</span> flag.startswith(flag_prefix)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assert</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  pt = bytes_to_long(flag[<span class="built_in">len</span>(flag_prefix):-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">  ct = <span class="built_in">pow</span>(pt, e, N)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;ct=<span class="subst">&#123;<span class="built_in">hex</span>(ct)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">e=0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">N=0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hints=[1, 3, 0, 3, 9, 16, 10, 14, 5, 11, 21, 18, 30, 30, 38, 2, 20, 62, 66, 1, 22, 56, 41, 13, 78, 59, 51, 6, 57, 117, 73, 75, 96, 112, 50, 93, 158, 97, 146, 8, 65, 96, 186, 161, 90, 131, 46, 32, 140, 133, 50, 43, 151, 234]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ct=0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>审计代码发现这里是关键函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hints = []</span><br><span class="line"></span><br><span class="line"> M = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(sieve_base)):</span><br><span class="line"></span><br><span class="line">   li = sieve_base[i]</span><br><span class="line">   </span><br><span class="line">   hints.append(d%li)</span><br><span class="line">   </span><br><span class="line">   M *= li</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> M.bit_length() &gt;= <span class="number">1024</span>*gamma:</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> e, N, hints</span><br></pre></td></tr></table></figure>
<p>这里我们可以得到hint的同余方程组 <span class="math display">$$
\left\{
\begin{array}{l}
\operatorname{hint}_{0} \equiv d \ (\bmod \ sieve_base[1]) \\
\operatorname{hint}_{1} \equiv d \ (\bmod \ sieve_base[2]) \\
\cdots \\
\operatorname{hint}_{r} \equiv d \ (\bmod \ sieve_base[i])
\end{array}
\right.
$$</span></p>
<p>同时还可以得到M的等式 <span class="math display">$$
M=\prod_{i=1}^{len(sieve_base)}sieve_base[i]
$$</span></p>
<p>我们可以先用crt来恢复部分的d</p>
<p>之所以这里只能恢复部分的d是因为</p>
<p>crt可以让我们从 <span
class="math inline"><em>d</em> mod  <em>l</em><sub><em>i</em></sub></span>
的这些余数中，计算出 <span
class="math inline"><em>d</em> mod  <em>M</em></span></p>
<p>所以我们得到的是d在模M下的值，即 <span
class="math display"><em>d</em> ≡ <em>d</em><sub>0</sub> mod  <em>M</em></span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">e=<span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line"></span><br><span class="line">N=<span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ct=<span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">hints = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">56</span>, <span class="number">41</span>, <span class="number">13</span>, <span class="number">78</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">50</span>, <span class="number">93</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">146</span>, <span class="number">8</span>, <span class="number">65</span>, <span class="number">96</span>, <span class="number">186</span>, <span class="number">161</span>, <span class="number">90</span>, <span class="number">131</span>, <span class="number">46</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">133</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">234</span>]</span><br><span class="line"></span><br><span class="line">dd = CRT(hints, <span class="built_in">list</span>(sieve_base)[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">tmp = prod(<span class="built_in">list</span>(sieve_base)[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dd)</span><br></pre></td></tr></table></figure>
<p>这里求出了<span
class="math inline"><em>d</em><sub>0</sub></span>即是部分的d，部分私钥泄露会想到用Cooper来打</p>
<p>这里看到RSA的等式 <span
class="math display"><em>e</em>(<em>d</em>0 + <em>k</em>0 * <em>M</em>) − 1 = <em>k</em>1(<em>N</em> − <em>p</em> − <em>q</em> + 1)</span>
d=d0+k*M</p>
<p>有等式 <span
class="math display"><em>e</em> * (<em>d</em>0 + <em>k</em> * <em>M</em>) − 1 = <em>k</em><sub>2</sub>(<em>N</em> − <em>p</em> − <em>q</em> + 1)</span>
这里考虑用⼆元copper来打，先对等式进行变形 <span
class="math display">1 − <em>e</em> * <em>d</em><sub>0</sub> + <em>k</em>(<em>N</em> + 1 − <em>r</em>) ≡ 0 (mod  <em>e</em> * <em>M</em>)</span>
这样的式子就可以打了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">e=<span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line"></span><br><span class="line">N=<span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ct=<span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">hints = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">56</span>, <span class="number">41</span>, <span class="number">13</span>, <span class="number">78</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">50</span>, <span class="number">93</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">146</span>, <span class="number">8</span>, <span class="number">65</span>, <span class="number">96</span>, <span class="number">186</span>, <span class="number">161</span>, <span class="number">90</span>, <span class="number">131</span>, <span class="number">46</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">133</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">234</span>]</span><br><span class="line"></span><br><span class="line">d0 = CRT(hints, <span class="built_in">list</span>(sieve_base)[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d0)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line"></span><br><span class="line"> d = f.degree()</span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"> R = f.base_ring()</span><br><span class="line"></span><br><span class="line"> N = R.cardinality()</span><br><span class="line"></span><br><span class="line"> f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"> f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line"> G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line"></span><br><span class="line"> base = N ^ (m - i) * f ^ i</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line"></span><br><span class="line">  g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line"></span><br><span class="line">  G.append(g)</span><br><span class="line"></span><br><span class="line"> B, monomials = G.coefficient_matrix()</span><br><span class="line"></span><br><span class="line"> monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line"> factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line"></span><br><span class="line"> B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line"> B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line"> B = B.change_ring(QQ)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line"></span><br><span class="line"> B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line"> H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line"></span><br><span class="line"> H.append(h)</span><br><span class="line"></span><br><span class="line"> I = H.ideal()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">  H.pop()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">  roots = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line"></span><br><span class="line">  root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line"></span><br><span class="line">  roots.append(root)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">e=<span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line"></span><br><span class="line">N=<span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line"></span><br><span class="line">hints=[<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">56</span>, <span class="number">41</span>, <span class="number">13</span>, <span class="number">78</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">50</span>, <span class="number">93</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">146</span>, <span class="number">8</span>, <span class="number">65</span>, <span class="number">96</span>, <span class="number">186</span>, <span class="number">161</span>, <span class="number">90</span>, <span class="number">131</span>, <span class="number">46</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">133</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">234</span>]</span><br><span class="line"></span><br><span class="line">ct=<span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"></span><br><span class="line">beta = <span class="number">0.33</span></span><br><span class="line"></span><br><span class="line">M = prod(<span class="built_in">list</span>(sieve_base)[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(Zmod(e*M), <span class="string">&#x27;x,y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x,y = PR.gens()</span><br><span class="line"></span><br><span class="line">f = x*(N+<span class="number">1</span>)-x*y-(e*d0-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">bounds =((e*<span class="number">2</span>**<span class="built_in">int</span>(<span class="number">2048</span>*beta)) // N ,<span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">roots = small_roots(f, bounds)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(roots)</span><br><span class="line"></span><br><span class="line">k=<span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">r=<span class="built_in">int</span>(roots[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">d = (k*(N+<span class="number">1</span>-r) + <span class="number">1</span>) // e</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(ct, d, N)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<h1 id="dasctf2025-strange-rsa">DASCTF2025 Strange RSA</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, hint</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, GCD, bytes_to_long, inverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_flag_params</span>(<span class="params">keysize=<span class="number">256</span></span>):</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    p, q = getPrime(keysize), getPrime(keysize)</span><br><span class="line"></span><br><span class="line">    N = p * q</span><br><span class="line"></span><br><span class="line">    A = (p**<span class="number">4</span> - <span class="number">1</span>) * (q**<span class="number">4</span> - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">      u = random.randint(<span class="number">2</span>, <span class="number">1</span> &lt;&lt; <span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">      v = random.randint(<span class="number">2</span>, <span class="number">1</span> &lt;&lt; <span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> GCD(u, v) == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    w = random.randint(-(v * N) + <span class="number">1</span>, v * N - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    numerator = w + A * v</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> numerator % u != <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    e = numerator // u</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> e &lt;= <span class="number">0</span> <span class="keyword">or</span> GCD(A, e) != <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;N&#x27;</span>: N, <span class="string">&#x27;u&#x27;</span>: u, <span class="string">&#x27;v&#x27;</span>: v, <span class="string">&#x27;e&#x27;</span>: e&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_hint_params</span>(<span class="params">u, v, keysize=<span class="number">512</span></span>):</span><br><span class="line"></span><br><span class="line">  p, q = getPrime(keysize), getPrime(keysize)</span><br><span class="line"></span><br><span class="line">  N = p*q</span><br><span class="line"></span><br><span class="line">  phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  e1, e2 = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">      x = getPrime(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">      d1 = (v+u)*x</span><br><span class="line"></span><br><span class="line">      d2 = (v-u)*x</span><br><span class="line"></span><br><span class="line">      e1 = inverse(d1, phi)</span><br><span class="line"></span><br><span class="line">      e2 = inverse(d2, phi)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;<span class="string">&#x27;e1&#x27;</span>: e1, <span class="string">&#x27;e2&#x27;</span>: e2, <span class="string">&#x27;N&#x27;</span>: N&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">flag, hint</span>):</span><br><span class="line"></span><br><span class="line">  params = generate_flag_params()</span><br><span class="line"></span><br><span class="line">  N1, u, v, e1 = params[<span class="string">&#x27;N&#x27;</span>], params[<span class="string">&#x27;u&#x27;</span>], params[<span class="string">&#x27;v&#x27;</span>], params[<span class="string">&#x27;e&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  e2, e3, N2 = generate_hint_params(u, v)</span><br><span class="line"></span><br><span class="line">  flag_ct = <span class="built_in">pow</span>(bytes_to_long(flag), e1, N1)</span><br><span class="line"></span><br><span class="line">  hint_ct = <span class="built_in">pow</span>(bytes_to_long(hint), random.choice([e2, e3]), N2)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;flag_ct&#x27;</span>: flag_ct,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;hint_ct&#x27;</span>: hint_ct,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;N1&#x27;</span>: N1,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;N2&#x27;</span>: N2,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;e1&#x27;</span>: e1,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;e2&#x27;</span>: e2,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;e3&#x27;</span>: e3</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">  res = encrypt(flag, hint)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;flag ciphertext: <span class="subst">&#123;res[<span class="string">&quot;flag_ct&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;hint ciphertext: <span class="subst">&#123;res[<span class="string">&quot;hint_ct&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;N1: <span class="subst">&#123;res[<span class="string">&quot;N1&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;N2: <span class="subst">&#123;res[<span class="string">&quot;N2&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;e1: <span class="subst">&#123;res[<span class="string">&quot;e1&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;e2: <span class="subst">&#123;res[<span class="string">&quot;e2&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;e3: <span class="subst">&#123;res[<span class="string">&quot;e3&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  \<span class="comment"># flag_ct = 3304275694820454674685997231149613707569155279977829020394149986905099581809908257209756187158847732534210083918959247704733651870464045546533643246315075</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># hint_ct = 92640601724170927054025127187177279602224180611842629533022715235486983387366622510122048491911345879387849666443268190910926361909061627381467094692466413099146606063231426714299807657192175870860604519763163994726401817194260892563952333383283965304691493157326860489170198604706615586060763745868090002740</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># N1 = 7348121907179526913580177851026954330752768738291896096735058973559480119932817354982584848148959373549116865913413457772773261195054845650206020666330991</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># N2 = 107505436651153972868256172927458682863384962980950626300023016225072477035531962210081972740487894427658040878262205693734911880215972363343499849037411996091935215324499998500280001539069563664673471788918797180228775246203241297837846844704493266809513512780251834022988415242950525647295962207347676276159</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># e1 = 46483493180168456907876964472003342599505589423824575610973682748466876137876722746536417805454147792987530564436875226141952843276430892859209813871491418332469407742523023206446900477888407552315053106617523965303933309326359897043169707586465120984991379773865649114063608940450932600749494216244527815359</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># e2 = 45077696779822473738225957332830108221557084179697632022751654753481408195463722246182963143687869636871041685807164964262563391336227375090607312507452525793175139773473714173537596307343530651384764927086658506652872283207536853955899859738928440798959619962363749291669111681250920552149008464286936309009</span></span><br><span class="line"></span><br><span class="line">  \<span class="comment"># e3 = 23550626043318531686392597908767473613369638520090152127370654817423383818034484441592543825793324637247596257173381762273905254049903422039592935871962187682259917270517329309332496277455914971819636329971254701142348560600765095893262007065327568577225527780321485212099754825195447682395092115782178271206767089362177657624379873520519398661669609981034432208973165597218334711366939977911593062941916527006025062935544853270685363226130039339985009309168493915830639441795502226746782561939904234398557509011544985054339634943750567054335128439233603858646704023191283512166289385748291358620388592170413196949907</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题目分为两个部分,一部分是对hint的加密，一部分是对flag的加密</p>
<p>我们先解出hint</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_hint_params</span>(<span class="params">u, v, keysize=<span class="number">512</span></span>):</span><br><span class="line"></span><br><span class="line">  p, q = getPrime(keysize), getPrime(keysize)</span><br><span class="line"></span><br><span class="line">  N = p*q</span><br><span class="line"></span><br><span class="line">  phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  e1, e2 = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">​      x = getPrime(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">​      d1 = (v+u)*x</span><br><span class="line"></span><br><span class="line">​      d2 = (v-u)*x</span><br><span class="line"></span><br><span class="line">​      e1 = inverse(d1, phi)</span><br><span class="line"></span><br><span class="line">​      e2 = inverse(d2, phi)</span><br><span class="line"></span><br><span class="line">​      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">​      <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;<span class="string">&#x27;e1&#x27;</span>: e1, <span class="string">&#x27;e2&#x27;</span>: e2, <span class="string">&#x27;N&#x27;</span>: N&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们发现可以用Boneh-Durfee攻击来求d1，d2</p>
<p>这里先看u,v和d1，d2的生成表达式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">u = random.randint(<span class="number">2</span>, <span class="number">1</span> &lt;&lt; <span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">v = random.randint(<span class="number">2</span>, <span class="number">1</span> &lt;&lt; <span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">x = getPrime(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">d1 = (v+u)*x</span><br><span class="line"></span><br><span class="line">d2 = (v-u)*x</span><br></pre></td></tr></table></figure>
<p>从这里我们知道<span
class="math inline"><em>d</em><sub>1</sub></span>,<span
class="math inline"><em>d</em><sub>2</sub></span>&lt;<span
class="math inline">2<sup>256 + 26</sup></span>,这里<span
class="math inline"><em>d</em> &gt; <em>N</em><sup>292</sup></span></p>
<p>满足Boneh-Durfee攻击，这里格的大小取8</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">​    <span class="built_in">print</span>(nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">​        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line"></span><br><span class="line">​        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">​            affected_vectors = <span class="number">0</span></span><br><span class="line">​            affected_vector_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line"></span><br><span class="line">​            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line"></span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line"></span><br><span class="line">​                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">​                    affected_vectors += <span class="number">1</span></span><br><span class="line">​                    affected_vector_index = jj</span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line"></span><br><span class="line">​            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">​                <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">​                BB = BB.delete_columns([ii])</span><br><span class="line">​                BB = BB.delete_rows([ii])</span><br><span class="line">​                monomials.pop(ii)</span><br><span class="line">​                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">​                <span class="keyword">return</span> BB</span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line"></span><br><span class="line">​            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">​                affected_deeper = <span class="literal">True</span></span><br><span class="line">​                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line"></span><br><span class="line">​                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">​                        affected_deeper = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line"></span><br><span class="line">​                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">​                    <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">​                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">​                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">​                    monomials.pop(affected_vector_index)</span><br><span class="line">​                    monomials.pop(ii)</span><br><span class="line">​                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">​                    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">      whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line"></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line"></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line"></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line"></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line"></span><br><span class="line">  ​      BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line"></span><br><span class="line">  ​      nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">  ​      <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">  ​          <span class="built_in">print</span>(<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">  ​          <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line"></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line"></span><br><span class="line">  ​          PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">  ​          pol1 = pol2 = <span class="number">0</span></span><br><span class="line">  ​          <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">  ​              pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">  ​              pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line"></span><br><span class="line">  ​          PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">  ​          rr = pol1.resultant(pol2)</span><br><span class="line">  ​    </span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line"></span><br><span class="line">  ​          <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">  ​              <span class="keyword">continue</span></span><br><span class="line">  ​          <span class="keyword">else</span>:</span><br><span class="line">  ​              <span class="built_in">print</span>(<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">  ​              found_polynomials = <span class="literal">True</span></span><br><span class="line">  ​              <span class="keyword">break</span></span><br><span class="line">  ​      <span class="keyword">if</span> found_polynomials:</span><br><span class="line">  ​          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line"></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line"></span><br><span class="line">​    N = <span class="number">107505436651153972868256172927458682863384962980950626300023016225072477035531962210081972740487894427658040878262205693734911880215972363343499849037411996091935215324499998500280001539069563664673471788918797180228775246203241297837846844704493266809513512780251834022988415242950525647295962207347676276159</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line"></span><br><span class="line">​    e = <span class="number">46483493180168456907876964472003342599505589423824575610973682748466876137876722746536417805454147792987530564436875226141952843276430892859209813871491418332469407742523023206446900477888407552315053106617523965303933309326359897043169707586465120984991379773865649114063608940450932600749494216244527815359</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line"></span><br><span class="line">​    delta = <span class="number">.276</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line">​    </span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line"></span><br><span class="line">​    m = <span class="number">8</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line"></span><br><span class="line">​    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">​    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">​    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line">​    </span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line"></span><br><span class="line">​    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">​    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">​    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line">​    </span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">#</span></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> debug:</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> debug:</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">​        start_time = time.time()</span><br><span class="line">​    </span><br><span class="line">​    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">​        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">​            <span class="built_in">print</span>(<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">​            <span class="built_in">print</span>(<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line">​    </span><br><span class="line">​        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">​    <span class="keyword">else</span>:</span><br><span class="line">​        <span class="built_in">print</span>(<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line">​    </span><br><span class="line">​    <span class="keyword">if</span> debug:</span><br><span class="line">​        <span class="built_in">print</span>((<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()</span><br></pre></td></tr></table></figure>
<p>这里观察到x是d1和d2的最大公因数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = gcd(d1,d2)</span><br></pre></td></tr></table></figure>
<p>求出x后u，v就很简单可以直接求出了</p>
<p>这里的hint知道是广义RSA</p>
<p>搜到这篇<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2025/380.pdf">paper</a></p>
<p>根据论文中</p>
<p><img src="/img/test_photo/image-20250804211432627.png" /></p>
<p>论文给出了怎么求p，q是通过先求出p的近似值在打cooper求的</p>
<p>这里是先求出<span class="math inline">$\widehat{p+q}$</span> ,和<span
class="math inline">$\widehat{p-q}$</span> 再将两式除2得到<span
class="math inline"><em>p̂</em></span>,然后打cooper</p>
<p>这里论文中u，v好像是通过连分数展开r求得的，但是我试了一下好像没有得到（不知道是不是我理解错了），但是对这道题没有什影响</p>
<p>得到p后就是常规的RSA了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, sqrt, mpfr, get_context, is_prime, powmod</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, GCD, bytes_to_long, inverse, long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, sqrt, mpfr, get_context, is_prime, powmod</span><br><span class="line"></span><br><span class="line">N1 = <span class="number">7348121907179526913580177851026954330752768738291896096735058973559480119932817354982584848148959373549116865913413457772773261195054845650206020666330991</span></span><br><span class="line"></span><br><span class="line">e3 = <span class="number">23550626043318531686392597908767473613369638520090152127370654817423383818034484441592543825793324637247596257173381762273905254049903422039592935871962187682259917270517329309332496277455914971819636329971254701142348560600765095893262007065327568577225527780321485212099754825195447682395092115782178271206767089362177657624379873520519398661669609981034432208973165597218334711366939977911593062941916527006025062935544853270685363226130039339985009309168493915830639441795502226746782561939904234398557509011544985054339634943750567054335128439233603858646704023191283512166289385748291358620388592170413196949907</span></span><br><span class="line"></span><br><span class="line">d1 = <span class="number">1285707407708336469611922789424965876916577005852352154890635610024931952186455505</span></span><br><span class="line"></span><br><span class="line">d2 = <span class="number">1649010712229782299850848551980277578291258538000633837589698050054193337459137087</span></span><br><span class="line"></span><br><span class="line">flag_ct = <span class="number">3304275694820454674685997231149613707569155279977829020394149986905099581809908257209756187158847732534210083918959247704733651870464045546533643246315075</span></span><br><span class="line"></span><br><span class="line">x = gmpy2.gcd(d1,d2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">\<span class="comment">#这里x是最大的公因数，求出u,v</span></span><br><span class="line"></span><br><span class="line">v_and_u = d1 // x  </span><br><span class="line"></span><br><span class="line">v_sub_u = d2 // x  </span><br><span class="line"></span><br><span class="line">v, u = (v_and_u + v_sub_u) // <span class="number">2</span>, (v_and_u - v_sub_u) // <span class="number">2</span>  </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v,u)</span><br><span class="line"></span><br><span class="line">p_and_q = floor(sqrt(<span class="built_in">abs</span>(<span class="number">2</span> * N1 + sqrt((N1^<span class="number">2</span> + <span class="number">1</span>)^<span class="number">2</span> - (e3 * u) / v))))</span><br><span class="line"></span><br><span class="line">p_sub_q = floor(sqrt(<span class="built_in">abs</span>(-<span class="number">2</span> * N1 + sqrt((N1^<span class="number">2</span> + <span class="number">1</span>)^<span class="number">2</span> - (e3 * u) / v))))</span><br><span class="line"></span><br><span class="line">p0 = <span class="number">115498994696631776334354360421501383036996098182355289461602274761923389881332</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(N1)[]</span><br><span class="line"></span><br><span class="line">f = x + p0</span><br><span class="line"></span><br><span class="line">f = f.monic()</span><br><span class="line"></span><br><span class="line">pad = f.small_roots(X = <span class="number">2</span>^<span class="number">16</span>, beta = <span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line">p = ZZ(p0 + pad[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">q = N1 // p</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse_mod(e3, phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(flag_ct, d, N1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure>
<h1 id="deadsec-ctf2024-raul-rosas">Deadsec CTF2024 Raul Rosas</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"></span><br><span class="line">p1 = <span class="built_in">bin</span>(getPrime(<span class="number">1024</span>))[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">p2 = p1[:<span class="number">605</span>]       <span class="number">419</span></span><br><span class="line"></span><br><span class="line">p2 = p2 + (<span class="string">&#x27;0&#x27;</span>*(<span class="built_in">len</span>(p1)-<span class="built_in">len</span>(p2)))</span><br><span class="line"></span><br><span class="line">p1 = <span class="built_in">int</span>(p1,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p2 = nextprime(<span class="built_in">int</span>(p2,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">q1 = getPrime(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">q2 = getPrime(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">n1 = p1*p1*q1 </span><br><span class="line"></span><br><span class="line">n2 = p2*p2*q2 </span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span> </span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(<span class="string">b&#x27;REDACTED&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(flag,e,n1)</span><br><span class="line"></span><br><span class="line">c2 = <span class="built_in">pow</span>(flag,e,n2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n1=&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n2=&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c1=&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c2=&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">n1=33914684861748025775039281034732118800210172226202865626649257734640860626122496857824722482435571212266837521062975265470108636677204118801674455876175256919094583111702086440374440069720564836535455468886946320281180036997133848753476194808776154286740338853149382219104098930424628379244203425638143586895732678175237573473771798480275214400819978317207532566320561087373402673942574292313462136068626729114505686759701305592972367260477978324301469299251420212283758756993372112866755859599750559165005003201133841030574381795101573167606659158769490361449603797836102692182242091338045317594471059984757228202609971840405638858696334676026230362235521239830379389872765912383844262135900613776738814453</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">n2=45676791074605066998943099103364315794006332282441283064976666268034083630735700946472676852534025506807314001461603559827433723291528233236210007601454376876234611894686433890588598497194981540553814858726066215204034517808726230108550384400665772370055344973309767254730566845236167460471232855535131280959838577294392570538301153645042892860893604629926657287846345355440026453883519493151299226289819375073507978835796436834205595029397133882344120359631326071197504087811348353107585352525436957117561997040934067881585416375733220284897170841715716721313708208669285280362958902914780961119036511592607473063247721427765849962400322051875888323638189434117452309193654141881914639294164650898861297303</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">c1=5901547799381070840359392038174495588170513247847714273595411167296183629412915012222227027356430642556122066895371444948863326101566394976530551223412292667644441453331065752759544619792554573114517925105448879969399346787436142706971884168511458472259984991259195488997495087540800463362289424481986635322685691583804462882482621269852340750338483349943910768394808039522826196641550659069967791745064008046300108627004744686494254057929843770761235779923141642086541365488201157760211440185514437408144860842733403640608261720306139244013974182714767738134497204545868435961883422098094282377180143072849852529146164709312766146939608395412424617384059645917698095750364523710239164016515753752257367489</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">c2=3390569979784056878736266202871557824004856366694719533085092616630555208111973443587439052592998102055488632207160968490605754861061546019836966349190018267098889823086718042220586285728994179393183870155266933282043334755304139243271973119125463775794806745935480171168951943663617953860813929121178431737477240925668994665543833309966378218572247768170043609879504955562993281112055931542971553613629203301798161781786253559679002805820092716314906043601765180455118897800232982799905604384587625502913096329061269176369601390578862509347479694697409545495592160695530037113884443071693090949908858172105089597051790694863761129626857737468493438459158669342430468741236573321658187309329276080990875017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>题目不难读懂，感觉有很多奇技淫巧来解</p>
<p>首先来审计代码，这里的代码十分简洁</p>
<p>给我们p1是一个1024bit的数，并且将其转为二进制</p>
<p>然后p2是取p1前419位，后面空出的位数用0来补齐</p>
<p>接着取p2的下一个素数</p>
<p>q1，q2的数量级都是300bit</p>
<p>最后给出了n1，n2 <span
class="math display"><em>n</em>1 = <em>p</em>1<sup>2</sup> * <em>q</em>1</span></p>
<p><span
class="math display"><em>n</em>2 = <em>p</em>2<sup>2</sup> * <em>q</em>2</span></p>
<p>因为这里的p2是取p1的前419位，所以n1，n2大概也是相近的</p>
<p>所以用连分数展开 <span class="math display">$$
\frac{n1}{n2} \approx \frac{q1}{q2}
$$</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">n1=<span class="number">33914684861748025775039281034732118800210172226202865626649257734640860626122496857824722482435571212266837521062975265470108636677204118801674455876175256919094583111702086440374440069720564836535455468886946320281180036997133848753476194808776154286740338853149382219104098930424628379244203425638143586895732678175237573473771798480275214400819978317207532566320561087373402673942574292313462136068626729114505686759701305592972367260477978324301469299251420212283758756993372112866755859599750559165005003201133841030574381795101573167606659158769490361449603797836102692182242091338045317594471059984757228202609971840405638858696334676026230362235521239830379389872765912383844262135900613776738814453</span></span><br><span class="line"></span><br><span class="line">n2=<span class="number">45676791074605066998943099103364315794006332282441283064976666268034083630735700946472676852534025506807314001461603559827433723291528233236210007601454376876234611894686433890588598497194981540553814858726066215204034517808726230108550384400665772370055344973309767254730566845236167460471232855535131280959838577294392570538301153645042892860893604629926657287846345355440026453883519493151299226289819375073507978835796436834205595029397133882344120359631326071197504087811348353107585352525436957117561997040934067881585416375733220284897170841715716721313708208669285280362958902914780961119036511592607473063247721427765849962400322051875888323638189434117452309193654141881914639294164650898861297303</span></span><br><span class="line"></span><br><span class="line">cf = continued_fraction(Integer(n1) / Integer(n2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">2000</span>):</span><br><span class="line"></span><br><span class="line">  q1 = <span class="built_in">int</span>(cf.numerator(i))    <span class="comment">#获取连分数的分子</span></span><br><span class="line"></span><br><span class="line">  q2 = <span class="built_in">int</span>(cf.denominator(i))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> n1 % q1 == <span class="number">0</span> <span class="keyword">or</span> n2 % q2 == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(q1,q2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>这样就得到了q1和q2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1,q2 = 1226422900699937313306345486827490610540478397988332672940596868693721441368094739238893997,1651764208712002362909070586532659043033781575172011989418709627827265240039573208353001543</span><br></pre></td></tr></table></figure>
<p>接下来就是解RSA了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q1,q2 = <span class="number">1226422900699937313306345486827490610540478397988332672940596868693721441368094739238893997</span>,<span class="number">1651764208712002362909070586532659043033781575172011989418709627827265240039573208353001543</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">c1=<span class="number">5901547799381070840359392038174495588170513247847714273595411167296183629412915012222227027356430642556122066895371444948863326101566394976530551223412292667644441453331065752759544619792554573114517925105448879969399346787436142706971884168511458472259984991259195488997495087540800463362289424481986635322685691583804462882482621269852340750338483349943910768394808039522826196641550659069967791745064008046300108627004744686494254057929843770761235779923141642086541365488201157760211440185514437408144860842733403640608261720306139244013974182714767738134497204545868435961883422098094282377180143072849852529146164709312766146939608395412424617384059645917698095750364523710239164016515753752257367489</span></span><br><span class="line"></span><br><span class="line">n1=<span class="number">33914684861748025775039281034732118800210172226202865626649257734640860626122496857824722482435571212266837521062975265470108636677204118801674455876175256919094583111702086440374440069720564836535455468886946320281180036997133848753476194808776154286740338853149382219104098930424628379244203425638143586895732678175237573473771798480275214400819978317207532566320561087373402673942574292313462136068626729114505686759701305592972367260477978324301469299251420212283758756993372112866755859599750559165005003201133841030574381795101573167606659158769490361449603797836102692182242091338045317594471059984757228202609971840405638858696334676026230362235521239830379389872765912383844262135900613776738814453</span></span><br><span class="line"></span><br><span class="line">p1 = gmpy2.iroot(n1//q1,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">d1 = gmpy2.invert(e, p1*(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d1,n1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1))</span><br></pre></td></tr></table></figure>
<p>还有个是用二元cooper来打的 <span
class="math display"><em>n</em>2 = <em>p</em><sub>2</sub><sup>2</sup> * <em>q</em><sub>2</sub> = (<em>x</em> * 2<sup>605</sup> + <em>p</em><sub><em>l</em><em>o</em><em>w</em></sub>)<sup>2</sup> * <em>y</em></span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line"></span><br><span class="line"> d = f.degree()</span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"> R = f.base_ring()</span><br><span class="line"></span><br><span class="line"> N = R.cardinality()</span><br><span class="line"></span><br><span class="line"> f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"> f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line"> G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line"></span><br><span class="line"> base = N ^ (m - i) * f ^ i</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line"></span><br><span class="line">  g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line"></span><br><span class="line">  G.append(g)</span><br><span class="line"></span><br><span class="line"> B, monomials = G.coefficient_matrix()</span><br><span class="line"></span><br><span class="line"> monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line"> factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line"></span><br><span class="line"> B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line"> B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line"> B = B.change_ring(QQ)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line"></span><br><span class="line"> B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line"> H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line"></span><br><span class="line"> H.append(h)</span><br><span class="line"></span><br><span class="line"> I = H.ideal()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">  H.pop()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">  roots = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line"></span><br><span class="line">  root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line"></span><br><span class="line">  roots.append(root)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n2=<span class="number">45676791074605066998943099103364315794006332282441283064976666268034083630735700946472676852534025506807314001461603559827433723291528233236210007601454376876234611894686433890588598497194981540553814858726066215204034517808726230108550384400665772370055344973309767254730566845236167460471232855535131280959838577294392570538301153645042892860893604629926657287846345355440026453883519493151299226289819375073507978835796436834205595029397133882344120359631326071197504087811348353107585352525436957117561997040934067881585416375733220284897170841715716721313708208669285280362958902914780961119036511592607473063247721427765849962400322051875888323638189434117452309193654141881914639294164650898861297303</span></span><br><span class="line"></span><br><span class="line">c2=<span class="number">3390569979784056878736266202871557824004856366694719533085092616630555208111973443587439052592998102055488632207160968490605754861061546019836966349190018267098889823086718042220586285728994179393183870155266933282043334755304139243271973119125463775794806745935480171168951943663617953860813929121178431737477240925668994665543833309966378218572247768170043609879504955562993281112055931542971553613629203301798161781786253559679002805820092716314906043601765180455118897800232982799905604384587625502913096329061269176369601390578862509347479694697409545495592160695530037113884443071693090949908858172105089597051790694863761129626857737468493438459158669342430468741236573321658187309329276080990875017</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p_lo <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">2000</span>)):</span><br><span class="line"></span><br><span class="line">  R = Integers(n)</span><br><span class="line"></span><br><span class="line">  P.&lt;x, y&gt; = PolynomialRing(R)</span><br><span class="line"></span><br><span class="line">  sz = <span class="number">1024</span>-<span class="number">605</span></span><br><span class="line"></span><br><span class="line">  f = (x * (<span class="number">2</span>^sz) + p_lo)^<span class="number">2</span> * (y + <span class="number">2</span>^<span class="number">299</span>)</span><br><span class="line"></span><br><span class="line">  bounds = (<span class="number">2</span>^(<span class="number">1024</span>-sz), <span class="number">2</span>^<span class="number">298</span>)</span><br><span class="line"></span><br><span class="line">  roots = small_roots(f, bounds)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  p_hi = <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">  p = p_hi*(<span class="number">2</span>^sz) + <span class="built_in">int</span>(p_lo)</span><br><span class="line"></span><br><span class="line">  p = <span class="built_in">int</span>(p)</span><br><span class="line"></span><br><span class="line">  n = <span class="built_in">int</span>(n)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> GCD(p, n) &gt; <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">​    <span class="built_in">print</span>(p_lo)</span><br><span class="line"></span><br><span class="line">​    <span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">assert</span> is_prime(p)</span><br><span class="line"></span><br><span class="line">​    q = n // (p*p)</span><br><span class="line"></span><br><span class="line">​    phi = p * (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">​    d = <span class="built_in">pow</span>(<span class="number">65537</span>, -<span class="number">1</span>, phi)</span><br><span class="line"></span><br><span class="line">​    m = <span class="built_in">pow</span>(c2, d, n)</span><br><span class="line"></span><br><span class="line">​    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h1 id="idekctf-2025-diamond-ticket">idekCTF 2025 Diamond Ticket</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#Some magic from Willy Wonka</span></span><br><span class="line">p = <span class="number">170829625398370252501980763763988409583</span></span><br><span class="line">a = <span class="number">164164878498114882034745803752027154293</span></span><br><span class="line">b = <span class="number">125172356708896457197207880391835698381</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chocolate_generator</span>(<span class="params">m:<span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(a, m, p) + <span class="built_in">pow</span>(b, m, p)) % p</span><br><span class="line"></span><br><span class="line"><span class="comment">#The diamond ticket is hiding inside chocolate</span></span><br><span class="line">diamond_ticket = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(diamond_ticket) == <span class="number">26</span></span><br><span class="line"><span class="keyword">assert</span> diamond_ticket[:<span class="number">5</span>] == <span class="string">b&quot;idek&#123;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> diamond_ticket[-<span class="number">1</span>:] == <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line">diamond_ticket = bytes_to_long(diamond_ticket[<span class="number">5</span>:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag_chocolate = chocolate_generator(diamond_ticket)</span><br><span class="line">chocolate_bag = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#Willy Wonka are making chocolates</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1337</span>):</span><br><span class="line">    chocolate_bag.append(getRandomRange(<span class="number">1</span>, p))</span><br><span class="line"></span><br><span class="line"><span class="comment">#And he put the golden ticket at the end</span></span><br><span class="line">chocolate_bag.append(flag_chocolate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Augustus ate lots of chocolates, but he can&#x27;t eat all cuz he is full now :D</span></span><br><span class="line">remain = chocolate_bag[-<span class="number">5</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">#Compress all remain chocolates into one</span></span><br><span class="line">remain_bytes = <span class="string">b&quot;&quot;</span>.join([c.to_bytes(p.bit_length()//<span class="number">8</span>, <span class="string">&quot;big&quot;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> remain])</span><br><span class="line"></span><br><span class="line"><span class="comment">#The last chocolate is too important, so Willy Wonka did magic again</span></span><br><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line">Q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = P * Q</span><br><span class="line">e = bytes_to_long(<span class="string">b&quot;idek&#123;this_is_a_fake_flag_lolol&#125;&quot;</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (P - <span class="number">1</span>) * (Q - <span class="number">1</span>))</span><br><span class="line">c1 = <span class="built_in">pow</span>(bytes_to_long(remain_bytes), e, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(bytes_to_long(remain_bytes), <span class="number">2</span>, N) <span class="comment"># A small gift</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#How can you get it ?</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c1 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c2 = &#125;</span>&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">N = 85494791395295332945307239533692379607357839212287019473638934253301452108522067416218735796494842928689545564411909493378925446256067741352255455231566967041733698260315140928382934156213563527493360928094724419798812564716724034316384416100417243844799045176599197680353109658153148874265234750977838548867</span></span><br><span class="line"><span class="string">c1 = 27062074196834458670191422120857456217979308440332928563784961101978948466368298802765973020349433121726736536899260504828388992133435359919764627760887966221328744451867771955587357887373143789000307996739905387064272569624412963289163997701702446706106089751532607059085577031825157942847678226256408018301</span></span><br><span class="line"><span class="string">c2 = 30493926769307279620402715377825804330944677680927170388776891152831425786788516825687413453427866619728035923364764078434617853754697076732657422609080720944160407383110441379382589644898380399280520469116924641442283645426172683945640914810778133226061767682464112690072473051344933447823488551784450844649</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://giapppp.github.io/posts/idekctf-2025/">idekCTF 2025
- Giap’s Blog</a></p>
<p>这里出题人的wp</p>
<p>首先是题目给出了一个自定义函数,我们还知道其中a,b,p的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chocolate_generator</span>(<span class="params">m:<span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(a, m, p) + <span class="built_in">pow</span>(b, m, p)) % p</span><br></pre></td></tr></table></figure>
<p>然后给出一下的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#The diamond ticket is hiding inside chocolate</span></span><br><span class="line">diamond_ticket = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(diamond_ticket) == <span class="number">26</span></span><br><span class="line"><span class="keyword">assert</span> diamond_ticket[:<span class="number">5</span>] == <span class="string">b&quot;idek&#123;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> diamond_ticket[-<span class="number">1</span>:] == <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line">diamond_ticket = bytes_to_long(diamond_ticket[<span class="number">5</span>:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag_chocolate = chocolate_generator(diamond_ticket)</span><br><span class="line">chocolate_bag = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#Willy Wonka are making chocolates</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1337</span>):</span><br><span class="line">    chocolate_bag.append(getRandomRange(<span class="number">1</span>, p))</span><br><span class="line"></span><br><span class="line"><span class="comment">#And he put the golden ticket at the end</span></span><br><span class="line">chocolate_bag.append(flag_chocolate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Augustus ate lots of chocolates, but he can&#x27;t eat all cuz he is full now :D</span></span><br><span class="line">remain = chocolate_bag[-<span class="number">5</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">#Compress all remain chocolates into one</span></span><br><span class="line">remain_bytes = <span class="string">b&quot;&quot;</span>.join([c.to_bytes(p.bit_length()//<span class="number">8</span>, <span class="string">&quot;big&quot;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> remain])</span><br></pre></td></tr></table></figure>
<p>生成1337个随机数，其中范围是(1，p)然后存入chocolate_bag中</p>
<p>再将flag_chocolate加入chocolate_bag的末尾</p>
<p>remain是取chocolate_bag的最后五位数，然后将这个五个元素拼接为字节串</p>
<p>接着又是一个新的加密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line">Q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = P * Q</span><br><span class="line">e = bytes_to_long(<span class="string">b&quot;idek&#123;this_is_a_fake_flag_lolol&#125;&quot;</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (P - <span class="number">1</span>) * (Q - <span class="number">1</span>))</span><br><span class="line">c1 = <span class="built_in">pow</span>(bytes_to_long(remain_bytes), e, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(bytes_to_long(remain_bytes), <span class="number">2</span>, N) <span class="comment"># A small gift</span></span><br></pre></td></tr></table></figure>
<p>这里很明显用共模攻击可以直接打，那么可以恢复出remain_bytes</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">85494791395295332945307239533692379607357839212287019473638934253301452108522067416218735796494842928689545564411909493378925446256067741352255455231566967041733698260315140928382934156213563527493360928094724419798812564716724034316384416100417243844799045176599197680353109658153148874265234750977838548867</span></span><br><span class="line">c1 = <span class="number">27062074196834458670191422120857456217979308440332928563784961101978948466368298802765973020349433121726736536899260504828388992133435359919764627760887966221328744451867771955587357887373143789000307996739905387064272569624412963289163997701702446706106089751532607059085577031825157942847678226256408018301</span></span><br><span class="line">c2 = <span class="number">30493926769307279620402715377825804330944677680927170388776891152831425786788516825687413453427866619728035923364764078434617853754697076732657422609080720944160407383110441379382589644898380399280520469116924641442283645426172683945640914810778133226061767682464112690072473051344933447823488551784450844649</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># e 是 b&quot;idek&#123;this_is_a_fake_flag_lolol&#125;&quot; 转成的整数</span></span><br><span class="line"></span><br><span class="line">e = bytes_to_long(<span class="string">b&quot;idek&#123;this_is_a_fake_flag_lolol&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展欧几里得算法求 a, b</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>, <span class="number">0</span>, a)</span><br><span class="line">    x1, y1, g = egcd(b, a % b)</span><br><span class="line">    <span class="keyword">return</span> (y1, x1 - (a // b) * y1, g)</span><br><span class="line"></span><br><span class="line">a, b, g = egcd(e, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保得到的是 e*a + 2*b = 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> e*a + <span class="number">2</span>*b == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果有负数指数，要取模逆</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> a &lt; <span class="number">0</span>:</span><br><span class="line">    c1 = <span class="built_in">pow</span>(c1, -<span class="number">1</span>, N)</span><br><span class="line">    a = -a</span><br><span class="line"><span class="keyword">if</span> b &lt; <span class="number">0</span>:</span><br><span class="line">    c2 = <span class="built_in">pow</span>(c2, -<span class="number">1</span>, N)</span><br><span class="line">    b = -b</span><br><span class="line"></span><br><span class="line">rb = (<span class="built_in">pow</span>(c1, a, N) * <span class="built_in">pow</span>(c2, b, N)) % N</span><br><span class="line">remain_bytes = long_to_bytes(rb)[-<span class="number">16</span>:]</span><br><span class="line">flag_chocolate = bytes_to_long(remain_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag_chocolate)</span><br></pre></td></tr></table></figure>
<p>现在我们可以列出方程 <span
class="math display"><em>c</em> ≡ <em>a</em><sup><em>m</em></sup> + <em>b</em><sup><em>m</em></sup> (mod  <em>p</em>)</span>
我们不妨令<span
class="math inline"><em>b</em> = <em>a</em><sup><em>k</em></sup></span>,那么我们就有
<span
class="math display"><em>c</em> ≡ <em>a</em><sup><em>m</em></sup> + (<em>a</em><sup><em>k</em></sup>)<sup><em>m</em></sup> (mod  <em>p</em>)</span></p>
<p><span
class="math display"><em>c</em> ≡ <em>a</em><sup><em>m</em></sup> + (<em>a</em><sup><em>k</em></sup>)<sup><em>m</em></sup> (mod  <em>p</em>)</span></p>
<p>现在再令X=a^m,那么就有方程 <span
class="math display"><em>c</em> ≡ <em>X</em> + <em>X</em><sup><em>k</em></sup> (mod  <em>p</em>)</span>
解这个X的trick在<a
target="_blank" rel="noopener" href="https://adib.au/2025/lance-hard/#speedup-by-using-gcd">这里</a></p>
<p><img
src="/img/test_photo/4cf295a7867dc9fb54fc5f733d6f4670.png" /></p>
<p>我们可以先求出k</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">170829625398370252501980763763988409583</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">164164878498114882034745803752027154293</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">125172356708896457197207880391835698381</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">k=sympy.discrete_log(p,b,a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(k)</span><br><span class="line"><span class="comment">#也可以直接用sage中的函数解</span></span><br><span class="line">k = GF(p)(b).log(a)</span><br></pre></td></tr></table></figure>
<p>根据上面的列出方程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">170829625398370252501980763763988409583</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">164164878498114882034745803752027154293</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">125172356708896457197207880391835698381</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">99584795316725433978492646071734128819</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line"></span><br><span class="line">f = x + x^k - c</span><br><span class="line"></span><br><span class="line">g = <span class="built_in">pow</span>(x, p, f) - x</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f.gcd(g).roots())</span><br></pre></td></tr></table></figure>
<p>然后就是在解一个离散对数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m = GF(p)(X).log(a)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">170829625398370252501980763763988409583</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">164164878498114882034745803752027154293</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">125172356708896457197207880391835698381</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">99584795316725433978492646071734128819</span></span><br><span class="line"></span><br><span class="line">k = GF(p)(b).log(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(k)</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line"></span><br><span class="line">f = x + x**k - c</span><br><span class="line"></span><br><span class="line">g = <span class="built_in">pow</span>(x, p, f) - x</span><br><span class="line"></span><br><span class="line">X = [r <span class="keyword">for</span> r <span class="keyword">in</span> f.gcd(g).roots()][<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">m = GF(p)(X).log(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;m = &#125;</span>&#x27;</span>) <span class="comment"># 4807895356063327854843653048517090061</span></span><br></pre></td></tr></table></figure>
<p>这里求出的m是m%p后的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">load(<span class="string">&#x27;https://raw.githubusercontent.com/TheBlupper/linineq/refs/heads/main/linineq.py&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">170829625398370252501980763763988409583</span></span><br><span class="line">o = (p-<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">m = <span class="number">4807895356063327854843653048517090061</span></span><br><span class="line"></span><br><span class="line">M = matrix([[<span class="number">256</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">20</span>))]])</span><br><span class="line">b = [m]</span><br><span class="line">lb = [<span class="number">30</span>]*<span class="number">20</span> </span><br><span class="line">ub = [<span class="number">128</span>]*<span class="number">20</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sol <span class="keyword">in</span> solve_bounded_mod_gen(M, b, lb, ub, o, solver=<span class="string">&#x27;ortools&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bytes</span>(sol))</span><br></pre></td></tr></table></figure>
<h1 id="idekctf-2024-golden-ticket">idekCTF 2024 Golden Ticket</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#Some magic from Willy Wonka</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chocolate_generator</span>(<span class="params">m:<span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    p = <span class="number">396430433566694153228963024068183195900644000015629930982017434859080008533624204265038366113052353086248115602503012179807206251960510130759852727353283868788493357310003786807</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(<span class="number">13</span>, m, p) + <span class="built_in">pow</span>(<span class="number">37</span>, m, p)) % p</span><br><span class="line"></span><br><span class="line"><span class="comment">#The golden ticket is hiding inside chocolate</span></span><br><span class="line">flag = <span class="string">b&quot;idek&#123;REDACTED&#125;&quot;</span></span><br><span class="line">golden_ticket = bytes_to_long(flag)</span><br><span class="line">flag_chocolate = chocolate_generator(golden_ticket)</span><br><span class="line">chocolate_bag = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#Willy Wonka is making chocolates</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(golden_ticket):</span><br><span class="line">    chocolate_bag.append(chocolate_generator(i))</span><br><span class="line"></span><br><span class="line"><span class="comment">#And he put the golden ticket at the end</span></span><br><span class="line">chocolate_bag.append(flag_chocolate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Augustus ate lots of chocolates, but he can&#x27;t eat all cuz he is full now :D</span></span><br><span class="line">remain = chocolate_bag[-<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">#Can you help Charles get the golden ticket?</span></span><br><span class="line"><span class="built_in">print</span>(remain)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[88952575866827947965983024351948428571644045481852955585307229868427303211803239917835211249629755846575548754617810635567272526061976590304647326424871380247801316189016325247, 67077340815509559968966395605991498895734870241569147039932716484176494534953008553337442440573747593113271897771706973941604973691227887232994456813209749283078720189994152242]</span></span><br></pre></td></tr></table></figure>
<p>上题就是在这题的基础上进行改进</p>
<p>golden_ticket：将flag数值化后的结果 flag_chocolate =
chocolate_generator(golden_ticket) p =
396430433566694153228963024068183195900644000015629930982017434859080008533624204265038366113052353086248115602503012179807206251960510130759852727353283868788493357310003786807
返回 (pow(13, golden_ticket, p) + pow(37, golden_ticket, p)) % p
chocolate_bag = [] 对于0以上、golden_ticket未満的i，执行以下操作：
将chocolate_generator(i)添加到chocolate_bag中
将flag_chocolate添加到chocolate_bag中 remain:
chocolate_bag的最后两个元素 输出remain</p>
<p>我们有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(x + y) % p = c1</span><br><span class="line">(13 * x + 37 * y) % p = c2</span><br></pre></td></tr></table></figure>
$$
=
<p>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">396430433566694153228963024068183195900644000015629930982017434859080008533624204265038366113052353086248115602503012179807206251960510130759852727353283868788493357310003786807</span></span><br><span class="line">c1 = <span class="number">88952575866827947965983024351948428571644045481852955585307229868427303211803239917835211249629755846575548754617810635567272526061976590304647326424871380247801316189016325247</span></span><br><span class="line">c2 = <span class="number">67077340815509559968966395605991498895734870241569147039932716484176494534953008553337442440573747593113271897771706973941604973691227887232994456813209749283078720189994152242</span></span><br><span class="line"></span><br><span class="line">A = matrix(Zmod(p), [[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">13</span>, <span class="number">37</span>]])</span><br><span class="line">C = matrix(Zmod(p), [[c1], [c2]])</span><br><span class="line">X = ~A * C</span><br><span class="line"></span><br><span class="line">x = X[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">y = X[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">X = matrix(Zmod(p), [[x], [y]])</span><br><span class="line"></span><br><span class="line">R = IntegerModRing(p)</span><br><span class="line">golden_ticket = <span class="built_in">int</span>(discrete_log(R(y), R(<span class="number">37</span>))) + <span class="number">1</span></span><br><span class="line">flag = long_to_bytes(golden_ticket).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h1 id="whyctf-2025">WHYCTF 2025</h1>
<h2 id="substituteteacher">substituteteacher</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Lcb gpzs tpvcbx phpzsvl ewig lgbsmc mwpl, bpmc xgwj p lzse, mwtx pmmivplzws. Pswlcbg dzvvzsh jbgvws mpvb, pswlcbg xbpx bsx, pswlcbg dzvbgpytb Libvxpe. Xblbmlzub Dztbv Mwgyzs, lcpl&#x27;v ewi, psx ewig miggbsl tbpx (p mgejlzm, fplbg-xpdphbx swlb rwisx zs p jzhbws&#x27;v sbvl – xws&#x27;l pva) cpv ygwihcl ewi lw lcb bxhb wr lcb zsrpdwiv Gpubsfwwx Fwwxv. Twmptv fczvjbgbx lptbv wr vlgpshb tzhclv psx bubs vlgpshbg xzvpjjbpgpsmbv. &#x27;Jgwypyte kivl p jpglzmitpgte phhgbvvzub ypxhbg,&#x27; ewi&#x27;x dillbgbx lw ewigvbtr, yil lcb isbpvb zs ewig hil lwtx p xzrrbgbsl vlwge.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Lcb jplc, zr ewi mwitx bubs mptt zl lcpl, xzvvwtubx zslw p dixxe, wubghgwfs lgpma. Pcbpx, ypgbte uzvzytb lcgwihc lcb xwfsjwig, p rpzsl rtzmabg wr tzhcl. P mpyzs. Fwwxbs, xztpjzxplbx, psx twwazsh tzab zl cpx vfpttwfbx dwgb lcps p rbf vbmgblv.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;Fbtt, Dztbv,&#x27; ewi vzhcbx, &#x27;ewi&#x27;ub mbglpzste vbbs fwgvb zsuzlplzwsv lw lblpsiv.&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Ewi jivc wjbs lcb mgbpae fwwxbs xwwg. Lcb vdbtt wr xpdj bpglc psx vwdblczsh uphibte dblpttzm, tzab wtx jbsszbv, rzttv ewig swvlgztv. Pv ewi vlbj zsvzxb, p vixxbs, cbpue LCIX bmcwbv ybczsx ewi. Lcb xwwg vtpdv vcil. Ewi lge lcb cpsxtb. Twmabx. Psx sw pdwisl wr kzhhtzsh, gplltzsh, wg jwtzlb jtbpxzsh vbbdv lw dpab p xzrrbgbsmb.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>Ewi pgb zs p xzdte tzl, gbmlpshitpg gwwd. Lcb pzg zv lczma fzlc lcb vmbsl wr xpdj fwwx psx vwdblczsh isxbrzspytb, jbgcpjv kivl lcb tzshbgzsh xgbpx wr rwghwllbs tzubv. Gpzs vlgbpav xwfs lcb vzshtb, hgzde fzsxwf ws lcb rpg fptt. P mgixb fwwxbs lpytb, lfw gzmable mcpzgv, psx p xivle, dwlc-bplbs gih pgb lcb wste rigszligb. P vdptt, istzl rzgbjtpmb vzlv phpzsvl wsb fptt, zlv cbpglc rzttbx fzlc mwtx pvcbv. Ws lcb lpytb, p rtzmabgzsh wzt tpdj mpvlv xpsmzsh vcpxwfv. Sbql lw lcb tpdj tpev p swlbywwa fzlc lcb rwttwfzsh lbql vmgzyytbv ws zl: rtph&#123;yx96xy352436br4r8bm6mpxp5979y038&#125;.<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>直接用quipqiup解密即可得到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;The rain lashed against your trench coat, each drop a tiny, cold accusation. Another missing person case, another dead end, another miserable Tuesday. Detective Miles Corbin, that&#x27;s you, and your current lead (a cryptic, water-damaged note found in a pigeon&#x27;s nest – don&#x27;t ask) has brought you to the edge of the infamous Ravenwood Woods. Locals whispered tales of strange lights and even stranger disappearances. &#x27;Probably just a particularly aggressive badger,&#x27; you&#x27;d muttered to yourself, but the unease in your gut told a different story. The path, if you could even call it that, dissolved into a muddy, overgrown track. Ahead, barely visible through the downpour, a faint flicker of light. A cabin. Wooden, dilapidated, and looking like it had swallowed more than a few secrets. &#x27;Well, Miles,&#x27; you sighed, &#x27;you&#x27;ve certainly seen worse invitations to tetanus.&#x27; You push open the creaky wooden door. The smell of damp earth and something vaguely metallic, like old pennies, fills your nostrils. As you step inside, a sudden, heavy THUD echoes behind you. The door slams shut. You try the handle. Locked. And no amount of jiggling, rattling, or polite pleading seems to make a difference. &quot;</span>You are <span class="keyword">in</span> a dimly lit, rectangular room. The air <span class="keyword">is</span> thick <span class="keyword">with</span> the scent of damp wood <span class="keyword">and</span> something undefinable, perhaps just the lingering dread of forgotten lives. Rain streaks down the single, grimy window on the far wall. A crude wooden table, two rickety chairs, <span class="keyword">and</span> a dusty, moth-eaten rug are the only furniture. A small, unlit fireplace sits against one wall, its hearth filled <span class="keyword">with</span> cold ashes. On the table, a flickering oil lamp casts dancing shadows. Next to the lamp lays a notebook <span class="keyword">with</span> the following text scribbles on it: flag&#123;bd96db352436ef4f8ec6cada5979b038&#125;.<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="somkracht65537">somkracht65537</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">N = p*q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(<span class="string">b&quot;flag&#123;dummy_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ct1 = <span class="built_in">pow</span>(msg, e, N)</span><br><span class="line"></span><br><span class="line">ct2 = <span class="built_in">pow</span>(msg, p+q, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct1 = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct2 = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">N = 13172635138210286640933237746072073728198869440440273861514688422430115450596963502627269613634657978751692320585777768877613321668778514462972611542147278205792418292362109100597755668571861738781190210255903465162483813897653948305531342676537057130369323555420200545974179860718822410192595079238246216026529376260568656408216009127973127738250617629330070723654601189310430802429585919291621479622419163092371272056180409609142738265178224163465585013019636286435078812898907472859171136422659050412212315590509027225331104292443193693974638004592849794819591007103879538185323581422819852185166422985403024630123</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ct1 = 8499526321488266762028127474977263983474334713646962923180757984708039537289636737028409522654349845032612940144246996001396064450188534247830979105036627472087587636695469693411422088223080856169980341928057477564688506588678465277896123712776169270866525885072607021419929184184301722442524104467963680432737243478200661224741027413690099507128782156810842444314483076587935222998920241102484844741597333281611874849648935849985954902264102662618041817365284648356127737145896858259709819593359264714426125676691235985164360773645489923563993927995838346085066937602961724919392025887999986486672200850129835569774</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ct2 = 2263178005282615069738169250508811825030372342139636879043114251227029802177975391784856426659871916802959302578620910469427367218786299839311310420522660987052055310279591316813828952756984548230575321772825193775083404279028090110850848262192595930920326368607665856808251531130234210906413358662814500632504899088517752958423466186872534450108628371006268110210630017230741670440780982809417986017372337888735465439382827207990030719121834402226087906249993820193417658352914727984318783025375497623944699995700474418221251293446038111913247755996471673024017921092527032486774115935601292346440934530921157935322</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>题目十分简洁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ct1 = pow(msg, e, N)</span><br><span class="line"></span><br><span class="line">ct2 = pow(msg, p+q, N)</span><br></pre></td></tr></table></figure>
<p>这样的式子一看就是可以打共模攻击的，但是这里p+q的值不知道</p>
<p>由欧拉定理可以知道</p>
<p>如果gcd(m,N)=1 <span
class="math display"><em>m</em><sup><em>φ</em>(<em>N</em>)</sup> ≡ 1 (mod  <em>N</em>)</span>
对于任意整数 k有 <span
class="math display"><em>m</em><sup><em>a</em></sup> ≡ <em>m</em><sup><em>a</em></sup> + <em>k</em><em>φ</em>(<em>N</em>) (mod  <em>N</em>)</span>
指数可以加上（或减去）<span
class="math inline"><em>φ</em>(<em>N</em>)</span> 的倍数而不改变结果</p>
<p>这就是幂在 <span class="math inline"><em>φ</em>(<em>N</em>)</span>
的周期性</p>
<p>那么知道这里后面就简单了 <span
class="math display"><em>c</em><em>t</em>2 = <em>m</em><em>s</em><em>g</em><sup><em>p</em> + <em>q</em></sup> mod  <em>N</em></span></p>
<p><span
class="math display"><em>c</em><em>t</em>2 = <em>m</em><em>s</em><em>g</em><sup><em>p</em> + <em>q</em> + <em>φ</em>(<em>N</em>)</sup> mod  <em>N</em></span></p>
<p><span
class="math display"><em>c</em><em>t</em>2 = <em>m</em><em>s</em><em>g</em><sup><em>p</em> + <em>q</em> + (<em>p</em> * <em>q</em> − <em>p</em> − <em>q</em> + 1)</sup> mod  <em>N</em></span></p>
<p><span
class="math display"><em>c</em><em>t</em>2 = <em>m</em><em>s</em><em>g</em><sup><em>N</em> + 1</sup> mod  <em>N</em></span></p>
<p>接下来打个共模攻击就好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commom_modulus_attack</span>(<span class="params">c1, c2, e1, e2, n</span>):</span><br><span class="line"></span><br><span class="line">  gcd, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">    s1 = -s1</span><br><span class="line"></span><br><span class="line">    c1 = gmpy2.invert(c1, n)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">    s2 = -s2</span><br><span class="line"></span><br><span class="line">    c2 = gmpy2.invert(c2, n)</span><br><span class="line"></span><br><span class="line">  v = <span class="built_in">pow</span>(c1, s1, n)</span><br><span class="line"></span><br><span class="line">  w = <span class="built_in">pow</span>(c2, s2, n)</span><br><span class="line"></span><br><span class="line">  x = (v*w) % n</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">13172635138210286640933237746072073728198869440440273861514688422430115450596963502627269613634657978751692320585777768877613321668778514462972611542147278205792418292362109100597755668571861738781190210255903465162483813897653948305531342676537057130369323555420200545974179860718822410192595079238246216026529376260568656408216009127973127738250617629330070723654601189310430802429585919291621479622419163092371272056180409609142738265178224163465585013019636286435078812898907472859171136422659050412212315590509027225331104292443193693974638004592849794819591007103879538185323581422819852185166422985403024630123</span></span><br><span class="line"></span><br><span class="line">ct1 = <span class="number">8499526321488266762028127474977263983474334713646962923180757984708039537289636737028409522654349845032612940144246996001396064450188534247830979105036627472087587636695469693411422088223080856169980341928057477564688506588678465277896123712776169270866525885072607021419929184184301722442524104467963680432737243478200661224741027413690099507128782156810842444314483076587935222998920241102484844741597333281611874849648935849985954902264102662618041817365284648356127737145896858259709819593359264714426125676691235985164360773645489923563993927995838346085066937602961724919392025887999986486672200850129835569774</span></span><br><span class="line"></span><br><span class="line">ct2 = <span class="number">2263178005282615069738169250508811825030372342139636879043114251227029802177975391784856426659871916802959302578620910469427367218786299839311310420522660987052055310279591316813828952756984548230575321772825193775083404279028090110850848262192595930920326368607665856808251531130234210906413358662814500632504899088517752958423466186872534450108628371006268110210630017230741670440780982809417986017372337888735465439382827207990030719121834402226087906249993820193417658352914727984318783025375497623944699995700474418221251293446038111913247755996471673024017921092527032486774115935601292346440934530921157935322</span></span><br><span class="line"></span><br><span class="line">e1 = e</span><br><span class="line"></span><br><span class="line">e2 = N + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">m = commom_modulus_attack(ct1, ct2, e1, e2, N)</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(m).decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">yskm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/08/05/%E6%9D%82%E9%A2%98/">http://example.com/2025/08/05/%E6%9D%82%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">yskm</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/11/CMCTF2025/" title="CMCTF2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">CMCTF2025</div></div><div class="info-2"><div class="info-item-1">这里就对mix这题进行记录 mix 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475from Crypto.Util.number import *from secret import flagimport randomp = getStrongPrime(2048)q = getStrongPrime(2048)s = getStrongPrime(2048)r = int(裴波那契数列[2022])mask = b&#x27;******&#x27;enc1 = b&#x27;******&#x27;flag1 = b&#x27;CMCTF&#123;&#x27; +enc1 + mask  + b&#x27;&#125;&#x27;e = 0o10001m = bytes_to_long(enc1)n = p * q * rc =...</div></div></div></a><a class="pagination-related" href="/2025/08/19/NetDream2025/" title="NetDream2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">NetDream2025</div></div><div class="info-2"><div class="info-item-1">EzRSA 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import sysimport randomfrom sympy import nextprimeimport binasciiFLAG = b&quot;flag&#123;xxxxxxx&#125;&quot;BIT_SIZE = 512DIFF = 1000def generate_close_primes(bit_size, diff):  start = random.getrandbits(bit_size) | 1  p = nextprime(start)  q = nextprime(p + diff)  return p, qdef flag_to_int(flag_bytes):  return int.from_bytes(flag_bytes, byteorder=&#x27;big&#x27;)def main(): ...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">yskm</div><div class="author-info-description">I decide which body my bullets enter</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎各位师傅批评指正</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#nepnep2025-lattice-bros"><span class="toc-number">1.</span> <span class="toc-text">Nepnep2025 Lattice Bros</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nepnep2025-ezrsa2"><span class="toc-number">2.</span> <span class="toc-text">Nepnep2025 ezRSA2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dasctf2025-strange-rsa"><span class="toc-number">3.</span> <span class="toc-text">DASCTF2025 Strange RSA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#deadsec-ctf2024-raul-rosas"><span class="toc-number">4.</span> <span class="toc-text">Deadsec CTF2024 Raul Rosas</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idekctf-2025-diamond-ticket"><span class="toc-number">5.</span> <span class="toc-text">idekCTF 2025 Diamond Ticket</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idekctf-2024-golden-ticket"><span class="toc-number">6.</span> <span class="toc-text">idekCTF 2024 Golden Ticket</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#whyctf-2025"><span class="toc-number">7.</span> <span class="toc-text">WHYCTF 2025</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#substituteteacher"><span class="toc-number">7.1.</span> <span class="toc-text">substituteteacher</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#somkracht65537"><span class="toc-number">7.2.</span> <span class="toc-text">somkracht65537</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/15/Shamir's%20secret%20sharing/" title="Shamir's secret sharing">Shamir's secret sharing</a><time datetime="2025-09-15T05:23:35.198Z" title="发表于 2025-09-15 13:23:35">2025-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/02/h4ckcon/" title="h4ck0n CTF 2025">h4ck0n CTF 2025</a><time datetime="2025-09-02T05:08:20.544Z" title="发表于 2025-09-02 13:08:20">2025-09-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/02/Full%20Weak%20Engineer%20CTF%202025/" title="Full Weak Engineer CTF 2025">Full Weak Engineer CTF 2025</a><time datetime="2025-09-02T04:04:00.648Z" title="发表于 2025-09-02 12:04:00">2025-09-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/26/Lexington%20Informatics%20Tournament2025/" title="Lexington Informatics Tournament2025">Lexington Informatics Tournament2025</a><time datetime="2025-08-26T14:16:03.059Z" title="发表于 2025-08-26 22:16:03">2025-08-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/19/NetDream2025/" title="NetDream2025">NetDream2025</a><time datetime="2025-08-19T08:33:09.188Z" title="发表于 2025-08-19 16:33:09">2025-08-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By yskm</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><canvas id="snow"></canvas><script async src="/js/snow.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>